# 小报童文章下载器 v3.0

## 🎉 重大更新

v3.0版本采用全新的**去中心化架构**，彻底解决了困扰用户的"Extension context invalidated"问题！

## ✨ 主要特性

### 🔧 技术架构
- **去中心化设计**：所有逻辑在content script中完成，避免扩展上下文失效
- **API拦截技术**：直接拦截小报童API响应，确保数据完整性
- **本地文件生成**：在浏览器中直接生成下载文件，无需后台服务

### 🎯 核心功能
- **智能抓取**：自动识别并抓取所有文章内容
- **格式转换**：将HTML内容转换为Markdown格式
- **批量下载**：支持单个文件和合并文件下载
- **实时进度**：可视化界面显示抓取进度

### 🛡️ 稳定性保障
- **彻底解决Extension context invalidated错误**
- **智能去重**：自动避免重复文章
- **容错处理**：跳过异常数据，继续处理其他内容

## 📖 使用说明

### 1. 安装插件
1. 下载插件文件并解压
2. 打开Chrome浏览器，进入扩展程序管理页面
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"，选择插件文件夹

### 2. 使用步骤
1. **打开小报童专栏页面**
2. **手动滚动到页面底部**，确保所有文章都已加载显示
3. **页面右上角会自动出现下载器界面**
4. **点击"开始抓取"按钮**
5. **等待抓取完成**（界面会显示实时进度）
6. **点击"下载文件"按钮**
7. **选择需要的文件进行下载**

### 3. 下载选项
- **单个文件**：每篇文章单独保存为.md文件
- **合并文件**：所有文章合并为一个.md文件

## 🔄 版本对比

| 特性 | v1.0/v2.0 | v3.0 |
|------|-----------|------|
| 架构设计 | 依赖background script | 去中心化架构 |
| 稳定性 | 容易出现上下文错误 | 彻底解决上下文问题 |
| 用户界面 | 弹窗操作 | 页面内嵌界面 |
| 下载方式 | 自动下载到文件夹 | 用户手动选择下载 |
| 进度显示 | 基础进度条 | 详细可视化进度 |
| 错误处理 | 基础重试机制 | 完全避免核心错误 |

## 🚀 技术亮点

### 1. 去中心化架构
```javascript
// 不再依赖chrome.runtime.sendMessage
// 所有逻辑都在content script中完成
function generateDownloadLinks() {
  // 直接在页面中生成下载链接
  const blob = new Blob([content], { type: 'text/markdown' });
  const url = URL.createObjectURL(blob);
}
```

### 2. API拦截技术
```javascript
// 拦截XHR和Fetch请求
window.XMLHttpRequest = function() {
  // 重写XMLHttpRequest，拦截小报童API
};
```

### 3. 可视化界面
- 实时进度显示
- 清晰的状态反馈
- 友好的操作指导

## ⚠️ 注意事项

1. **手动滚动**：使用前请先手动滚动到页面底部，确保所有文章都已加载
2. **网络稳定**：建议在网络状况良好时使用
3. **浏览器兼容**：仅支持Chrome浏览器（Manifest V3）
4. **文件保存**：需要用户手动点击下载链接保存文件

## 🐛 问题排查

### 如果没有看到下载器界面
1. 刷新页面
2. 确认已正确安装插件
3. 检查是否在小报童专栏页面

### 如果抓取不完整
1. 确保已手动滚动到页面底部
2. 等待页面完全加载后再开始抓取
3. 检查网络连接是否稳定

### 如果下载失败
1. 检查浏览器是否允许下载
2. 尝试右键另存为
3. 清除浏览器缓存后重试

## 📝 更新日志

### v3.0.0 (2024-XX-XX)
- 🎉 采用去中心化架构，彻底解决Extension context invalidated问题
- ✨ 新增页面内嵌可视化界面
- 🔧 优化API拦截技术
- 📱 改进用户体验和操作流程
- 🛡️ 增强稳定性和容错能力

### v2.0.0
- 🔧 添加API拦截技术
- 🛡️ 实现重试机制
- 📊 改进进度显示

### v1.0.0
- 🎯 基础功能实现
- 📝 支持Markdown格式转换
- 📦 批量下载功能

## 📞 技术支持

如果在使用过程中遇到问题，请：
1. 首先尝试刷新页面
2. 检查是否按照使用说明操作
3. 查看浏览器控制台是否有错误信息

v3.0版本已经彻底解决了之前版本的核心问题，为用户提供更稳定、更可靠的使用体验！

